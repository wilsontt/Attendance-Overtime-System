# 🏢 出勤加班單系統 (Attendance Overtime System)

![Version](https://img.shields.io/badge/version-1.1.0-blue.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)
![React](https://img.shields.io/badge/React-19-61DAFB?logo=react&logoColor=black)
![TypeScript](https://img.shields.io/badge/TypeScript-5.0-3178C6?logo=typescript&logoColor=white)
![Vite](https://img.shields.io/badge/Vite-6.0-646CFF?logo=vite&logoColor=white)

一個專為企業設計的自動化出勤加班計算系統。透過上傳出勤打卡記錄（CSV 或 TXT 格式），系統能依照預設規則自動計算員工的加班時數與誤餐費，並支援報表匯出與列印，大幅節省人資與主管的核對時間。

## ✨ 主要功能

- **📂 快速匯入資料**：
  - 支援 **CSV** 與 **TXT** 兩種格式的出勤記錄批次上傳與解析
  - 智慧格式驗證，上傳失敗時提供明確的錯誤訊息
- **⚡ 自動化計算**（精準時間對齊機制）：
  - **加班時數**：
    - 平日：18:00 後起算，結束時間向下對齊至 30 分鐘單位
    - 假日：全天工時，開始時間向上對齊至整點、結束時間向下對齊至 30 分鐘單位
    - 計算結果自動對齊至 0.5 小時單位
  - **誤餐費**：平日下班時間 ≥ 19:30 自動給予 $50 補助
- **🔍 智慧篩選**：可依「員工姓名」或「日期範圍」快速查找特定記錄。
- **✅ 資料驗證**：
  - 預覽頁提供記錄選擇功能（可排除請假日或異常記錄）
  - 國定假日標記功能（可將平日轉為假日計算）
  - 加班原因必填驗證，確保報表完整性
- **📊 多元報表輸出**：
  - **Excel 下載**：匯出完整的計算明細試算表（分為平日/例假日兩個工作表）
  - **PDF 下載**：生成排版精美的 PDF 報告（支援中文顯示、頁碼標註）
  - **列印支援**：優化的網頁列印樣式，所見即所得

## 🛠️ 技術棧

本專案採用現代化前端技術構建：

- **核心框架**: [React 19](https://react.dev/)
- **開發語言**: [TypeScript](https://www.typescriptlang.org/)
- **建置工具**: [Vite](https://vitejs.dev/)
- **資料處理**: 
  - `react-papaparse` (CSV 解析)
  - `exceljs` (Excel 生成)
- **PDF 生成**: `html2canvas` + `jspdf` (解決中文字型顯示問題)

## 🚀 快速開始

### 前置需求
- [Node.js](https://nodejs.org/) (建議 v18 以上)
- npm 或 yarn

### 安裝步驟

1. **複製專案**
   git clone <repository-url>
   cd "出勤加班單系統"
   2. **進入前端目錄並安裝依賴**
   cd frontend
   npm install
   3. **啟動開發伺服器**
   
   npm run dev
      瀏覽器將自動開啟 `http://localhost:5173`。

## 📖 使用說明

### 1. 準備資料檔案

系統支援兩種格式：

#### 📄 CSV 格式
包含標頭的 CSV 檔案，欄位順序如下：

```csv
員工編號,姓名,歸屬日期,考勤別,數量,上班時間,下班時間
200038,王小明,1141001,空,0,08:50,20:00
200039,李小華,1141002,病假,1,09:00,18:30
```

#### 📄 TXT 格式
固定寬度格式的出勤刷卡記錄 TXT 檔案，必須包含：
- 標題行（員工姓名、歸屬日期）
- 員工編號與姓名
- 刷卡時間記錄
- 考勤別資訊（若有請假）

> **注意事項**：
> - 日期格式支援民國年（如 `1141001`）或西元格式
> - 時間格式請使用 `HH:mm`
> - 考勤別支援：`事假`、`病假`、`請年休假`、`公假`、`空`
> - TXT 檔案若格式錯誤，系統會顯示具體的錯誤原因

### 2. 計算規則詳細

#### 加班時數計算（含時間對齊機制）

| 項目 | 平日（週一至週五） | 假日（週六、週日、國定假日） |
| :--- | :--- | :--- |
| **加班起算** | 從 **18:00** 起算至下班時間 | **全天工時**（上班至下班） |
| **開始時間對齊** | - | 向上對齊至整點<br>（例：08:56 → 09:00） |
| **結束時間對齊** | 向下對齊至 30 分鐘單位<br>（例：19:45 → 19:30） | 向下對齊至 30 分鐘單位<br>（例：17:04 → 17:00） |
| **時數對齊** | 向下對齊至 0.5 小時<br>（例：1.67 → 1.5） | 向下對齊至 0.5 小時<br>（例：8.13 → 8.0） |
| **誤餐費** | 下班時間 **≥ 19:30**，給予 **$50** | 不提供 |

#### 計算範例

**範例 1：平日加班**
- 上班：08:00，下班：19:45
- 加班時間：18:00 - 19:30（對齊後）
- 加班時數：1.5 小時
- 誤餐費：$50

**範例 2：假日加班**
- 上班：08:56，下班：17:04
- 加班時間：09:00 - 17:00（對齊後）
- 加班時數：8.0 小時
- 誤餐費：$0

### 3. 預覽與報表產生

#### 預覽頁功能
點擊「下載」按鈕後會開啟預覽視窗，提供以下功能：
1. **記錄選擇**：勾選要包含在報表中的記錄
2. **國定假日標記**：手動標記國定假日（影響加班時數計算）
3. **工作地點填寫**：輸入工作地點資訊
4. **加班原因編輯**：填寫每筆記錄的加班原因（必填）
5. **自動分類**：系統自動分為「平日加班」與「例假日加班」兩個表格
6. **頁碼顯示**：每個表格區塊底部顯示頁碼

#### 報表輸出
預覽確認後，可選擇以下方式輸出：
- **下載 Excel**：產生 `.xlsx` 檔（包含平日與例假日兩個工作表）
- **下載 PDF**：產生 `.pdf` 檔（包含頁碼與完整格式）
- **列印報告**：開啟瀏覽器列印視窗

> **驗證提醒**：
> - 所有被選中且加班時數 ≥ 0.5 的記錄都必須填寫加班原因
> - 請假日記錄不需填寫加班原因
> - 未填寫時系統會阻止下載並提示未填寫的記錄編號

## �� 專案結構

```
frontend/
├── public/              # 靜態資源 (Logo 等)
├── src/
│   ├── components/      # React 元件 (上傳器、表格、報告產生器)
│   ├── services/        # 核心計算邏輯 (加班費、誤餐費公式)
│   ├── pages/           # 頁面入口
│   ├── types/           # TypeScript 型別定義
│   └── App.tsx          # 主程式
└── package.json         # 相依套件設定
```

## 📝 版本歷史

### v1.1.0 (2025-12-08)
**新增功能**：
- ✨ 支援 TXT 格式檔案上傳與解析
- ✨ 智慧格式驗證（檔案內容、標題行、記錄數量）
- ✨ 時間對齊機制（開始時間整點對齊、結束時間 30 分鐘對齊、時數 0.5 小時對齊）
- ✨ 預覽頁、PDF 與列印功能加入頁碼顯示
- ✨ 加班原因必填驗證（下載前檢查）
- ✨ 國定假日標記功能（可調整計算規則）
- ✨ 記錄選擇功能（可排除不需要的記錄）

**改進項目**：
- 🔧 加班時數計算更精準（符合實際對齊需求）
- 🔧 錯誤訊息更具體（幫助使用者快速定位問題）
- 🔧 報表格式更規範（分為平日/例假日兩個工作表）
- 📚 程式碼註解完整化（JSDoc/TypeDoc 格式）

**技術改進**：
- 🚀 新增 `txtParser.ts` 服務（TXT 檔案解析）
- 🚀 優化 `calculationService.ts`（時間對齊機制）
- 🚀 增強 `PreviewModal.tsx`（驗證與選擇功能）
- 🚀 改進 `reportService.ts`（頁碼支援）

詳細變更記錄請參閱：[CHANGELOG-20251208.md](./specs/001-attendance-overtime-system/CHANGELOG-20251208.md)

### v1.0.0 (2025-12-07)
**初始版本**：
- ✨ CSV 檔案上傳與解析
- ✨ 加班時數與誤餐費自動計算
- ✨ 姓名與日期範圍篩選
- ✨ Excel、PDF 報表匯出與列印功能

## 📄 License

This project is licensed under the MIT License.
    