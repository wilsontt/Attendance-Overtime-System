# Feature Specification: 出勤加班單系統

**Feature Branch**: `001-attendance-overtime-system`
**Created**: 2025-12-06
**Status**: Draft
**Input**: User description: "建立一個出勤加班單系統，能夠上傳出勤記錄，根據預設規則（平日、週末）自動計算每個人的加班時數，判斷平日加班是否可領取 50 元的誤餐費，並在網頁上顯示計算結果。"

## 使用者情境與測試 (必填)

### User Story 1 - 上傳出勤記錄並計算加班費 (Priority: P1)

作為一名人資或主管，我希望能上傳員工的出勤記錄檔案，系統能自動為我計算每位員工的加班時數與誤餐費，並清楚地顯示結果，以便我能快速完成薪資結算。

**Why this priority**: 這是此系統的核心功能，解決了手動計算耗時且容易出錯的主要痛點。

**Independent Test**: 可以上傳一個包含多名員工、多天（包含平日與假日）出勤記錄的檔案，並驗證系統計算出的加班總時數和誤餐費總金額是否與手動計算的結果一致。

**Acceptance Scenarios**:

1.  **Given** 我在系統的上傳頁面, **When** 我選擇一個格式正確的 CSV 出勤記錄檔案並點擊「上傳」, **Then** 系統頁面會顯示一個表格，其中包含每位員工、每一天的出勤時間、計算出的加班時數與誤餐費。
2.  **Given** 我上傳了一個檔案, **When** 檔案中的日期是星期一到星期五，且下班時間晚於 19:30, **Then** 系統應計算加班時數（從 18:00 到下班時間），並在誤餐費欄位標示 50 元。
3.  **Given** 我上傳了一個檔案, **When** 檔案中的日期是星期六或星期日, **Then** 系統應將當天所有工時都計算為加班時數，且誤餐費為 0 元。
4.  **Given** 我上傳了一個檔案, **When** 檔案中有部分記錄格式不符或資料缺失, **Then** 系統應能跳過這些錯誤記錄，完成正確記錄的計算，並在頁面上提示哪些記錄處理失敗。

---

### User Story 2 - 篩選與查詢特定員工或日期的加班記錄 (Priority: P2)

作為一名人資或主管，在查看計算結果時，我希望能依據員工姓名或特定日期範圍進行篩選，以便快速找到並核對特定人員或時間段的加班情況。

**Why this priority**: 在處理大量資料時，篩選功能是提升可用性的關鍵，能幫助使用者快速聚焦於所需資訊。

**Independent Test**: 在已顯示加班記錄的頁面，輸入特定員工姓名或選擇一個日期區間，驗證表格是否只顯示符合條件的記錄。

**Acceptance Scenarios**:

1.  **Given** 頁面上已顯示所有員工的加班記錄, **When** 我在員工姓名搜尋框中輸入「黃琨峻」並按下 Enter, **Then** 表格中應只剩下「黃琨峻」的加班記錄。
2.  **Given** 頁面上已顯示所有員工的加班記錄, **When** 我在日期選擇器中選擇一個特定的月份（例如「10月」）, **Then** 表格中應只顯示 10 月份的所有加班記錄。

---

### User Story 3 - 下載與列印加班記錄報告 (Priority: P3)

作為一名人資或主管，在計算並核對完加班資料後，我希望能將顯示的結果匯出成一個表格式文件（例如 PDF 或 Excel），以便我能將其存檔、列印出來或透過電子郵件發送給相關人員。

**Why this priority**: 提供報告的匯出功能，方便使用者進行線下存檔、審批流程或與其他系統整合，是許多管理工具的必要功能。

**Independent Test**: 在已顯示加班記錄的頁面，點擊「下載」或「列印」按鈕，驗證是否能成功下載一個包含當前顯示之所有記錄的檔案，且檔案內容與格式皆正確。

**Acceptance Scenarios**:

1.  **Given** 頁面上已顯示加班記錄, **When** 我點擊「下載報告」按鈕, **Then** 瀏覽器應下載一個表格式檔案（例如 `加班報告-2025-10.xlsx`）。
2.  **Given** 我已下載報告檔案, **When** 我打開該檔案, **Then** 檔案中的內容應與網頁上顯示的表格內容完全一致。
3.  **Given** 頁面上已顯示加班記錄, **When** 我點擊「列印報告」按鈕, **Then** 瀏覽器應開啟列印預覽視窗，且預覽的內容應是格式化後的加班記錄表格。

---

### Edge Cases

- 當上傳的檔案格式不正確時（例如，非 CSV 檔案），系統應如何處理？
- 當出勤記錄中只有上班打卡，沒有下班打卡時，該筆記錄應如何計算？
- 跨日的班別（例如，晚上 10 點上班，隔天早上 6 點下班）應如何計算加班？
- 當員工在假日有多次打卡記錄時，加班時數應如何計算？

## 需求 (必填)

### Functional Requirements

- **FR-001**: 系統 **必須** 提供一個網頁介面，讓使用者能上傳 CSV 格式的出勤記錄檔案。
- **FR-002**: 系統 **必須** 能夠解析上傳的 CSV 檔案，讀取員工編號、姓名、歸屬日期、上班時間、下班時間等欄位。CSV 檔案的欄位順序為：員工編號,姓名,歸屬日期,上班時間,下班時間。
- **FR-003**: 系統 **必須** 根據以下規則計算加班時數：
    - 週一至週五：加班時間從 18:00 計算至下班時間。
    - 週六、週日：當天的總工時全部計為加班時間。
- **FR-004**: 系統 **必須** 根據以下規則計算誤餐費：
    - 週一至週五：如下班時間等於或晚於 19:30，則提供 50 元誤餐費。
    - 週六、週日：不提供誤餐費。
- **FR-005**: 系統 **必須** 在網頁上以表格形式清晰地展示每位員工的每日出勤記錄、計算後的加班時數與誤餐費。
- **FR-006**: 系統 **必須** 提供依員工姓名和日期範圍篩選計算結果的功能。
- **FR-007**: 系統 **必須** 提供一個「下載報告」按鈕，讓使用者可以將當前顯示的加班記錄匯出成表格式檔案 (例如 Excel 或 PDF)。系統將同時提供 Excel (.xlsx) 和 PDF (.pdf) 兩種格式的下載選項。

### 關鍵實體 (若功能涉及資料)

- **員工 (Employee)**: 代表一名公司員工，至少包含員工編號和姓名。
- **出勤記錄 (AttendanceRecord)**: 代表一筆原始的打卡記錄，包含員工、歸屬日期、上班時間和下班時間。
- **加班報告 (OvertimeReport)**: 代表一筆計算完成的結果，包含員工、日期、加班時數和誤餐費。

## 假設 (必填)

- **AS-001**: 上傳的 CSV 檔案將嚴格遵循「員工編號,姓名,歸屬日期,上班時間,下班時間」的欄位順序和格式。
- **AS-002**: 上班時間和下班時間欄位將採用標準的時間格式（例如 HH:mm 或 HH:mm:ss）。
- **AS-003**: 系統處理的出勤記錄均在同一時區內，無需考慮跨時區轉換。

## 成功標準 (必填)

### 可衡量成果

- **SC-001**: 使用者能在 2 分鐘內完成從上傳檔案到看到計算結果的整個流程。
- **SC-002**: 對於一個包含 1000 筆出勤記錄的檔案，系統必須在 10 秒內完成所有計算並顯示結果。
- **SC-003**: 首次使用的使用者，有 95% 的人能夠在沒有外部協助的情況下成功完成一次加班計算。
- **SC-004**: 系統上線後，因加班費計算錯誤而產生的人資客訴案件數量需降低 90%。
